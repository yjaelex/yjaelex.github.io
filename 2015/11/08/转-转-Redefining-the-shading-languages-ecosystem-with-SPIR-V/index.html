<!-- build time:Thu Dec 29 2016 17:08:49 GMT+0800 (China Standard Time) --><!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="UTF-8"><title>[转][转] Redefining the shading languages ecosystem with SPIR-V-蓝天和白云的博客</title><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="author" content="Alex"><meta name="keywords" content="计算机图形, yjaelex, 蓝天和白云"><meta name="google-site-verification" content="9lcaJdZKsghYWk19tQSzSIdlKxsT0jta8L0Qnc2WLSM"><meta name="description" content="SPIR-V，全称Standard Portable Intermediate Representation&amp;nbsp;(SPIR)&amp;nbsp;是一种用在GPU通用计算和图形学上的中间语言（intermediatelanguage，类&amp;#20284;汇编）；由Khronos开发,最初是为OpenCL准备的。&amp;nbsp;目前的版本是SPIR-V，和下一代图形标准Vulkan差不多同时提出。前面版本的"><meta property="og:type" content="article"><meta property="og:title" content="[转][转] Redefining the shading languages ecosystem with SPIR-V"><meta property="og:url" content="http://yjaelex.github.io/2015/11/08/转-转-Redefining-the-shading-languages-ecosystem-with-SPIR-V/index.html"><meta property="og:site_name" content="蓝天和白云的博客"><meta property="og:description" content="SPIR-V，全称Standard Portable Intermediate Representation&amp;nbsp;(SPIR)&amp;nbsp;是一种用在GPU通用计算和图形学上的中间语言（intermediatelanguage，类&amp;#20284;汇编）；由Khronos开发,最初是为OpenCL准备的。&amp;nbsp;目前的版本是SPIR-V，和下一代图形标准Vulkan差不多同时提出。前面版本的"><meta property="og:image" content="http://img.blog.csdn.net/20151108173215688?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center"><meta property="og:image" content="http://img.blog.csdn.net/20151108173315148?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center"><meta property="og:image" content="http://img.blog.csdn.net/20151108173349740?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center"><meta property="og:image" content="http://img.blog.csdn.net/20151108173431099?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center"><meta property="og:updated_time" content="2016-12-29T08:42:30.130Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="[转][转] Redefining the shading languages ecosystem with SPIR-V"><meta name="twitter:description" content="SPIR-V，全称Standard Portable Intermediate Representation&amp;nbsp;(SPIR)&amp;nbsp;是一种用在GPU通用计算和图形学上的中间语言（intermediatelanguage，类&amp;#20284;汇编）；由Khronos开发,最初是为OpenCL准备的。&amp;nbsp;目前的版本是SPIR-V，和下一代图形标准Vulkan差不多同时提出。前面版本的"><meta name="twitter:image" content="http://img.blog.csdn.net/20151108173215688?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center"><link rel="alternative" href="/atom.xml" title="蓝天和白云的博客" type="application/atom+xml"><link rel="icon" href="/img/favicon.ico"><link rel="apple-touch-icon" href="/img/jacman.jpg"><link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg"><link rel="stylesheet" href="/css/style.css"></head></html><body><header><div><div id="imglogo"><a href="/"><img src="/img/logo.png" alt="蓝天和白云的博客" title="蓝天和白云的博客"></a></div><div id="textlogo"><h1 class="site-name"><a href="/" title="蓝天和白云的博客">蓝天和白云的博客</a></h1><h2 class="blog-motto">一个计算机图形爱好者</h2></div><div class="navbar"><a class="navbutton navmobile" href="#" title="菜单"></a></div><nav class="animated"><ul><ul><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li><li><a href="/about">关于</a></li><li><form class="search" action="http://zhannei.baidu.com/cse/search" target="_blank"><label>Search</label><input name="s" type="hidden" value="6862289814022638000"><input type="text" name="q" size="30" placeholder="搜索"><br></form></li></ul></ul></nav></div></header><div id="container"><div id="main" class="post" itemscope itemprop="blogPost"><article itemprop="articleBody"><header class="article-info clearfix"><h1 itemprop="name"><a href="/2015/11/08/转-转-Redefining-the-shading-languages-ecosystem-with-SPIR-V/" title="[转][转] Redefining the shading languages ecosystem with SPIR-V" itemprop="url">[转][转] Redefining the shading languages ecosystem with SPIR-V</a></h1><p class="article-author">By <a href="/about" title="Alex" target="_blank" itemprop="author">Alex</a></p><p class="article-time"><time datetime="2015-11-08T08:33:01.000Z" itemprop="datePublished">发表于 2015-11-08</time></p></header><div class="article-content"><div id="toc" class="toc-article"><strong class="toc-title">文章目录</strong></div><p>SPIR-V，全称<strong><span style="color:#252525;font-family:sans-serif;font-size:14px;line-height:22.4px">Standard Portable Intermediate Representation</span><span style="color:#252525;font-family:sans-serif;font-size:14px;line-height:22.4px">&nbsp;(</span><span style="color:#252525;font-family:sans-serif;font-size:14px;line-height:22.4px">SPIR</span></strong><span style="color:#252525;font-family:sans-serif;font-size:14px;line-height:22.4px"><strong>)</strong>&nbsp;是一种用在GPU通用计算和图形学上的中间语言（</span><a href="https://en.wikipedia.org/wiki/Intermediate_language" title="Intermediate language" rel="external nofollow noopener noreferrer" target="_blank">intermediate<br>language</a>，类&#20284;汇编）；由<a href="https://en.wikipedia.org/wiki/Khronos_Group" title="Khronos Group" rel="external nofollow noopener noreferrer" target="_blank">Khronos</a>开发<span style="color:#252525;font-family:sans-serif;font-size:14px;line-height:22.4px">,<br>最初是为</span><a href="https://en.wikipedia.org/wiki/OpenCL" title="OpenCL" rel="external nofollow noopener noreferrer" target="_blank">OpenCL</a>准备的。<span style="color:#252525;font-family:sans-serif;font-size:14px;line-height:22.4px">&nbsp;目前的版本是<br>SPIR-V，和下一代图形标准Vulkan差不多同时提出。前面版本的SPIR其实基于LLVM IR；而最新的<span style="color:#252525;font-family:sans-serif;font-size:14px;line-height:22.4px">SPIR-V则是重新定义了一套；当然还是和LLVM IR有些类&#20284;。</span></span></p><a id="more"></a><p><span style="color:#252525;font-family:sans-serif;font-size:14px;line-height:22.4px">SPIR的目的是为Shader或OpenCL kernel，提供一个平台设备无关的类汇编语言的标准。这样应用程序发布时可以使用二进制的类汇编&#26684;式Shader Binary；而不是像以前OpenGL那样直接在线编译GLSL。以前的方式需要提供Shader的源代码，这不安全。Vulkan以后会大量的走类&#20284;D3D的方式，只提供一个Shader二进制&#26684;式。</span></p><p><span style="color:#252525;font-family:sans-serif;font-size:14px;line-height:22.4px"></span></p><p></p><p><span style="color:#252525;font-family:sans-serif;font-size:14px;line-height:22.4px"></span></p><p>At Siggraph 2014, the Khronos Group announced the development of&nbsp;<a href="https://www.khronos.org/assets/uploads/developers/library/2014-siggraph-bof/OpenGL-Ecosystem-BOF_Aug14.pdf" rel="external nofollow noopener noreferrer" target="_blank">GLnext and a shader<br>IL</a>. They have a name now:&nbsp;<a href="https://www.khronos.org/vulkan" rel="external nofollow noopener noreferrer" target="_blank">Vulkan</a>&nbsp;and&nbsp;<a href="https://www.khronos.org/spir" rel="external nofollow noopener noreferrer" target="_blank">SPIR V</a>.</p><p>First, let’s clear out something: SPIR-V has nothing to do with SPIR. It’s built from scratch with marketing thinking it was a good idea to name two products with different version values. Ohhh, I can’t wait to battle against the confusions this idea will lead<br>to. SPIR-V is not tied to LLVM, it’s a fully specified and self-contained specification. It can represent both graphics code and compute code for any API, including Vulcan, OpenCL, OpenGL, OpenGL ES, WebGL, etc.</p><p>If we trust the industry is interested in solving actual developers’ problems, it will eventually be used outside the Khronos Group, for Direct3D, Metal, consoles and beyond!</p><p>The Khronos Group has published some great documents for SPIR-V:&nbsp;<a href="https://www.khronos.org/registry/spir-v/papers/WhitePaper.pdf" rel="external nofollow noopener noreferrer" target="_blank">a white paper</a>,&nbsp;<a href="https://www.khronos.org/registry/spir-v/specs/1.0/SPIRV.pdf" rel="external nofollow noopener noreferrer" target="_blank">a<br>provisial portable core specification</a>,&nbsp;<a href="https://www.khronos.org/registry/spir-v/specs/1.0/GLSL.std.450.pdf" rel="external nofollow noopener noreferrer" target="_blank">an provisial extended instructions for graphics specification</a>,&nbsp;<a href="https://www.khronos.org/registry/spir-v/specs/1.0/OpenCL.std.21.pdf" rel="external nofollow noopener noreferrer" target="_blank">an<br>provisial extended instructions for compute specification</a>. A work in progress&nbsp;<a href="https://www.khronos.org/opengles/sdk/tools/Reference-Compiler/" rel="external nofollow noopener noreferrer" target="_blank">GLSL to SPIR-V compiler</a>&nbsp;is also available.</p><div class="list" style="padding:8px 0;font-family:verdana;font-size:14px"><span class="list" style="margin:0">SPIR-V in a nutshell:</span><br><br><em>Better portability </em>Better runtime performance<br><em>Source languages independent </em>Fully specified<br><em>Simple binary </em>Extendable<br></div><p>####<br>A current shader cross-compilation pipeline</p><p>Engines will typically use a meta-HLSL or meta shading languages for their shader code. Historically, HLSL on desktop and consoles but GLSL on mobile and CAD/DCC/professional stuff because of markets differences and reality. An engine that wants to address<br>multiple markets is quickly confronted to the requirement of cross-compiling shaders from HLSL to GLSL and/or GLSL to HLSL for example with game engines. Alternatively, in the off-line rendering ecosystem, we could also imagine the issue happenning between&nbsp;<a href="http://www.openshading.com/" rel="external nofollow noopener noreferrer" target="_blank">Open<br>Shading Language</a>&nbsp;and<a href="https://renderman.pixar.com/resources/current/RenderMan/shadingLanguage.html" rel="external nofollow noopener noreferrer" target="_blank">RenderMan</a>.</p><p>To match the reality of the ecosystem, we have to cross compile the shading languages but this is always&nbsp;<a href="http://aras-p.info/blog/2014/03/28/cross-platform-shaders-in-2014/" rel="external nofollow noopener noreferrer" target="_blank">a painful process</a>&nbsp;as<br>illustrated in figure 1.</p><p><img src="http://img.blog.csdn.net/20151108173215688?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p><div class="post-image-white" style="width:816px;padding-top:0;padding-bottom:0;text-align:center;margin-left:auto;margin-right:auto;font-family:verdana;font-size:14px"><br><br></div><br><div class="post-image-title" style="font-style:italic;text-align:center;padding-bottom:32px;font-family:verdana;font-size:14px"><br>Figure 1: Shader compilation pipeline in Unity 5&#43;</div><p>Is this crazy and insane? Yes. However, it addresses the reality of the market which is complex and fragmented with a lot of legacy hardware and software. If there are reasons to use an engine, this is one. This pipeline is particularly complex but still GLSL<br>remains a second class shading language in the sense that this pipeline doesn’t allow to run GLSL code on Direct3D for example.</p><p>####<br>Issues with HLSL11 IL and D3D11 compiler</p><div class="list" style="padding:8px 0;font-family:verdana;font-size:14px"><span class="list" style="margin:0">In this pipeline HLSL and HLSL11 IL have a central place but HLSL11 IL is not specified and it’s produced by a closed source Windows only compiler.<br>Additionally, the D3D11 compiler should be a deprecated software because:</span><br><br><em>1 It was designed for legacy vec4 GPUs which implies wasting 50% of registers on vec2 and %25% on vec3. Considering that most GPUs hide memory access latencies by launching as many wavefronts as possible, GPUs can only launch new wavefronts when there is still<br>space available in the register file. Thus, D3D11 compiler cost a great deal of performance by wasting registers. </em>2 HLSL11 doesn’t expose many hardware features (<a href="https://www.opengl.org/registry/specs/ARB/shader_draw_parameters.txt" rel="external nofollow noopener noreferrer" target="_blank">gl_DrawID</a>,&nbsp;<a href="https://www.khronos.org/registry/gles/extensions/EXT/EXT_shader_pixel_local_storage.txt" rel="external nofollow noopener noreferrer" target="_blank">pixel<br>local storage</a>,&nbsp;<a href="https://www.khronos.org/registry/gles/extensions/EXT/EXT_shader_framebuffer_fetch.txt" rel="external nofollow noopener noreferrer" target="_blank">framebuffer fetch</a>). How to express these features in HLSL when we want to use them<br>in GLSL where they are available? Well, it’s hard and at best possible through ugly hacks!<br>* 3 D3D11 compiler performs destructive &quot;optimizations&quot; on the input shaders. Maybe, these &quot;optimizations&quot; where ok at some points in history but they prevent GPU vendors to properly optimize the shaders because source information gets lost. From where comes<br>from these massive performance gains from hotfix drivers on new AAA released games? At least, part of it from shaders replacements. If HLSL11 IL input is A, use this totally different binary. This process is probably ok for hardware vendors that can afford<br>it but this process won’t scale beyond some flagship AAA games. Hence, the rest of us, the 99%, are paying the price of a poor compiler.<br></div><p>####<br>Easier and more robust cross compilation with SPIR-V</p><p>SPIR-V is a fully specified, cross APIs, binary intermediate language which is easy to read, to extend or to ignore unknown instructions without destructing the source in a tool chain.</p><div class="post-image-white" style="width:816px;padding-top:0;padding-bottom:0;text-align:center;margin-left:auto;margin-right:auto;font-family:verdana;font-size:14px"><br><img src="http://img.blog.csdn.net/20151108173315148?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""><br><br></div><br><div class="post-image-title" style="font-style:italic;text-align:center;padding-bottom:32px;font-family:verdana;font-size:14px"><br>Figure 2: A more desiable shader compilation pipeline to match the market reality</div><p>In figure 2 shows how SPIR-V could be used as a center piece of the compilation pipeline allowing multiple front-ends / languages to produce the SPIR-V IL. On platforms supporting SPIR-V, we could directly feed APIs with SPIR-V. The reality is that it will<br>take a lot of time to transform the ecosystem and we need a solution for others platforms (eg: shipped mobiles which will never get new drivers). Hence, in a market real shader compilation pipeline, SPIR-V would need to be converted to HLSL9 IL, HLSL11 IL,<br>GLSL, Metal, etc.</p><p>This is a lot of work but SPIR-V provides a simpler and more robust approach to cross compile to others ILs and languages.&nbsp;<a href="https://github.com/James-Jones/HLSLCrossCompiler" rel="external nofollow noopener noreferrer" target="_blank">HLSLcc</a>&nbsp;is a great<br>tool that demonstrated that cross compilation at IL level is a good direction. Another example is&nbsp;<a href="http://blogs.unity3d.com/2014/05/20/the-future-of-scripting-in-unity/" rel="external nofollow noopener noreferrer" target="_blank">IL2CPP</a>&nbsp;used by Unity<br>to cross compile C# to C&#43;&#43;. However, HLSL11 IL has many issues, as expressed previously. With SPIR-V, the source IL is fully specified and extendable making the translation from SPIR-V to HLSL11 IL easier (or even possible) than HLSL11 IL to SPIR-V for example.</p><p>I am glade to see that some frameworks are already&nbsp;<a href="https://jogamp.org/bugzilla/show_bug.cgi?id=1140#c2" rel="external nofollow noopener noreferrer" target="_blank">investigating about SPIR-V</a>:&nbsp;<a href="https://jogamp.org/" rel="external nofollow noopener noreferrer" target="_blank">Jogamp</a>&nbsp;is<br>a Java binding for multiple APIs including OpenGL and OpenCL. SPIR-V will allow the framework users to target independently OpenGL compute of OpenCL depending framework users needs for example.</p><div class="post-image-white" style="width:816px;padding-top:0;padding-bottom:0;text-align:center;margin-left:auto;margin-right:auto;font-family:verdana;font-size:14px"><br><img src="http://img.blog.csdn.net/20151108173349740?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""><br><br></div><br><div class="post-image-title" style="font-style:italic;text-align:center;padding-bottom:32px;font-family:verdana;font-size:14px"><br>Figure 3: Dreaming of a large market adoption, wish: that’s the plan 5 years down this line</div><p>In figure 3, we show what would be the ultimate goal for SPIR-V: A massive adoption of the shading intermediate language so that we only have focus on innovations in the source language world. Great time to start a PHD on shading language!</p><p>In the current ecosystem, we have to generate N shaders per source because Direct3D 9, Direct3D 11, OpenGL and OpenGL ES accept different syntaxes. In many cases, only the syntax sugar is different but the functionality is exactly the same from API to API.<br>The multiplication of generated shaders has a production cost in iteration time and latency until we get the results that SPIR-V could ultimately avoid. One SPIR-V =&gt; N platforms. Ideally, only hardware feature levels would condition the generation of multiple<br>shader outputs.</p><p>####<br>Building bridges between ecosystems</p><p>Supporting multiple source languages as first class citizen is valuable for many reasons: The user case choice the shading language he like best but also to build bridges between ecosystem: off-line rendering and real-time rendering; Mobile and desktop; Simulation<br>and rendering,; etc!</p><p>Let’s take a common real-time use case: the case of skinning. For some games it might be valuable to do the skinning using a computer shader so that this work will be done on the GPU. However, some games might be GPU bound so to get better performance, it’s<br>probably a good idea to rely on the CPU. Let’s imagine that&nbsp;<a href="https://github.com/ispc/ispc" rel="external nofollow noopener noreferrer" target="_blank">ISPC</a>&nbsp;decides to support SPIR-V just like it supports&nbsp;<a href="https://github.com/ispc/ispc/blob/master/ptxtools/ptx.ll" rel="external nofollow noopener noreferrer" target="_blank">NVIDIA<br>PTX</a>&nbsp;for example. In such case an engine could create a single parallel friendly and optimized code and a game could choose either a GPU or CPU target for skinning depending on its needs.</p><p>Futhermore, SPIR-V allows to decouple the tools from the shipping software. There is no reason to ship a SPIR-V compiler such as ISPC or LLVM in a final game. It would increase export time and take a lot of space which is not desiable on mobile or WebGL platforms<br>where memory is critical.</p><p>####<br>Better matching of the engine reality: custom shading languages!</p><p>If we consider engine shading languages, most are actually meta-HLSL using custom syntax to expose built-in shaders, engine specific functionality, fallback systems, making easier/possible cross compilation and platform targeting or offering a more natural<br>way to expose shaders to technical shader artists.&nbsp;<a href="http://docs.unity3d.com/Manual/SL-Reference.html" rel="external nofollow noopener noreferrer" target="_blank">Unity shading language</a>&nbsp;is a good example of such meta-HLSL approach.</p><p>SPIR-V is offering us the opportunity to officialize these languages and even build the custom engine functionalities in their hearts through extended instruction sets. SPIR-V is built around a model where unrecognized blocks are just ignored and preserved,<br>allowing interactions with SPIR-V tools unaware of these extensions.</p><p>Going crazier, we could imagine in the future storing OpenGL states in SPIR-V or describing rendering passes with off-line tools capable to filter redundant states changes. Many opportunities to run our imagination wild!</p><p>On the opposity side, we could imagine innovations to design a shading language friendly for technical artists, exposing&nbsp;<a href="http://www.frostbite.com/2014/11/moving-frostbite-to-pbr/" rel="external nofollow noopener noreferrer" target="_blank">PBR</a>&nbsp;parametrization<br>for example or decoupling&nbsp;<a href="http://aras-p.info/blog/2009/05/07/shaders-must-die-part-2/" rel="external nofollow noopener noreferrer" target="_blank">surface shader, lighting model and light shader</a>&nbsp;natively in the language.</p><p>####<br>NOT resolved by SPIR V: &quot;Ohoho, on line shader compilation time is too long.&quot;</p><p>Some game developers would say that we need an IL for better online compilation performance. I think this is misunderstanding the cause of this issue. The slow part of the GLSL compilation isn’t the translation from GLSL to IHVs IL (eg&nbsp;<a href="http://docs.nvidia.com/cuda/parallel-thread-execution/#abstract" rel="external nofollow noopener noreferrer" target="_blank">NVIDIA<br>PTX</a>&nbsp;or&nbsp;<a href="http://amd-dev.wpengine.netdna-cdn.com/wordpress/media/2012/10/AMD_Intermediate_Language_%28IL%29_Specification_v2.pdf" rel="external nofollow noopener noreferrer" target="_blank">AMD IL</a>) but the optimizations path on the IHVs IL, particularly<br>register allocation and scheduling transformation. These operations are fully dependent of GPU architectures hence should be performed by a targeted platform hardware vendor compiler.</p><p>Parsing GLSL / HLSL and performing non destruction optimizations have a cost and moving these off-line will give us some online performance gains. However, following the&nbsp;<a href="http://en.wikipedia.org/wiki/Pareto_principle" rel="external nofollow noopener noreferrer" target="_blank">80-20<br>rule</a>, we should expect only 20% performance gain. Compilation is a finer art than just parsing languages.</p><p>####<br>NOT fully resolved by SPIR V: &quot;Ohoho, IHVs shader compilers are rubish.&quot;</p><p>A lot of issues with current GLSL compilers is that all of them support invalid syntaxes but hardware vendors don’t want to fix them because it could break some applications. Removing the language syntax avoid potential errors but if tools generate invalid<br>SPIR-V code, chances are that drivers will still do whatever it takes to garantee the IL works on their implementations. From an IHVs point of view, the worse is an application that doesn’t work on their platforms by run fine else where.</p><p>By design, SPIR-V doesn’t prevent IHVs to run invalid code so something else would need to be done to resolve this issue. Conformance tests? This said, I think that the simplicity of SPIR-V brings us to a much better state but the larger potential SPIR-V ecosystem<br>than GLSL makes it required to ensure SPIR-V code quality.</p><p>The other issue is that some shader compilers are terrible at performance trivial optimizations hence we will probably need to have a shader pipeline path to do this job.</p><p>####<br>Better integration of the shading language in modern graphics APIs:</p><div class="post-image-white" style="width:816px;padding-top:0;padding-bottom:0;text-align:center;margin-left:auto;margin-right:auto;font-family:verdana;font-size:14px"><br><img src="http://img.blog.csdn.net/20151108173431099?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""><br><br></div><br><div class="post-image-white" style="width:816px;padding-top:0;padding-bottom:0;text-align:center;margin-left:auto;margin-right:auto;font-family:verdana;font-size:14px"><br><span style="font-style:italic">Figure 4: Integration of SPIR-V in an explict graphics API such as Vulkan</span></div><p>Figure 4 shows a potential integration of SPIR-V in Vulkan. Basically, with OpenGL and GLSL, all the cross compilation can be done off-line but the rest, including the actual shader compilations, needs to happen in the rendering thread. With Vulkan, we can<br>decouple the tasks and guarantee that the rendering loop never compile shaders because of shader patching, play with shader cache or validate states. Additionally, we have a full control other the threaded shader compilations. With OpenGL, if we don’t query<br>the compilation results right after requesting a compilation, the drivers may thread and hide the compilation time but this behavior is not specified: Would the drivers actually thread the compilation? How many compilations can happen in parallel? Vulkan is<br>an explict API, hence we have control for each step, when, where and how these steps should be performed.</p><p>####<br>Time for celebrations before hard work for an ecosystem revolution!</p><p>I am absolutely convinced that SPIR-V is a game changer for the industry just like WebGL before it. However, there is no magic. To become really successful, it will take a lot of efforts to ensure adoption by hardware and platform vendors but also to adapt<br>SPIR-V to the reality of the market and build (open source!) cross compilation tools placing SPIR-V at their centers.</p><p>The head lines might be all about iPhone6 and Samsung S6 but the reality of the market is that we are seeing a race to the bottom with lot of old ES2 GPU IP shipping everyday. Furthermore, there is already a lot of devices already shipped that will never see<br>the color of a drivers update during their entire life time. Finally, Vulkan might be great and all but realistically it will take years for the ecosystem to complete this transition. Meanwhile, there is a lot of OpenGL/ES, WebGL, Direct3D, console APIs out<br>there. SPIR-V is solution for all of them!</p><p>I am looking forward the shading language revolution that SPIR-V will lead to, one step at a time!</p><p>Enjoy!</p><p>I cannot express how awesome this is. :-P<span class="quote-author" style="font-style:normal;text-align:right;display:block"><a href="https://twitter.com/JJcoolkl/status/572791033551036417" rel="external nofollow noopener noreferrer" target="_blank">John W<br>Kloetzli, Jr</a></span></p><ul><li><a href="https://www.khronos.org/registry/spir-v/papers/WhitePaper.pdf" rel="external nofollow noopener noreferrer" target="_blank">SPIR-V: whitepaper</a></li><li><a href="https://www.khronos.org/registry/spir-v/specs/1.0/SPIRV.pdf" rel="external nofollow noopener noreferrer" target="_blank">SPIR-V 0.99, provisiontal specification</a></li><li><a href="https://www.khronos.org/registry/spir-v/specs/1.0/GLSL.std.450.pdf" rel="external nofollow noopener noreferrer" target="_blank">SPIR-V Extended Instructions for GLSL, provisiontal specification</a></li><li><a href="https://www.khronos.org/registry/spir-v/specs/1.0/OpenCL.std.21.pdf" rel="external nofollow noopener noreferrer" target="_blank">SPIR-V OpenCL 2.1 Extended Instruction Set, provisiontal specification</a></li><li><a href="https://www.khronos.org/spir" rel="external nofollow noopener noreferrer" target="_blank">SPIR-V front page</a></li><li><a href="https://www.khronos.org/vulkan" rel="external nofollow noopener noreferrer" target="_blank">Vulkan front page</a></li></ul><p><br>本文地址 <a href="http://yjaelex.github.io/2015/11/08/转-转-Redefining-the-shading-languages-ecosystem-with-SPIR-V/">http://yjaelex.github.io/2015/11/08/转-转-Redefining-the-shading-languages-ecosystem-with-SPIR-V/</a> 作者为<a href="/about/"> Alex</a></p></div><div style="font-size:16px;BORDER-BOTTOM:#bbb 1px solid;BORDER-LEFT:#bbb 1px solid;BACKGROUND:#f6f6f6;MIN-HEIGHT:120px;BORDER-TOP:#bbb 1px solid;BORDER-RIGHT:#bbb 1px solid;MARGIN-LEFT:10px;MARGIN-RIGHT:10px;MARGIN-BOTTOM:10px" class="oec2003right"><div style="MARGIN-TOP:10px;FLOAT:left;MARGIN-LEFT:10px;MARGIN-RIGHT:10px"><img alt="author:Alex" src="http://yjaelex.github.io/imgs/myself.jpg" width="100" height="100"></div><div style="LINE-HEIGHT:200%;MARGIN:10px;COLOR:#000">Author: <a href="https://www.linkedin.com/in/yjaelex" rel="external nofollow noopener noreferrer" target="_blank">Alex</a> &nbsp&nbsp&nbsp&nbsp Blog: <a href="http://yjaelex.github.io/">http://yjaelex.github.io/</a>&nbsp&nbsp&nbsp&nbsp Email: <a href="mailto:yjaelex@163.com" rel="external nofollow noopener noreferrer" target="_blank">yjaelex@163.com</a><br>I have almost 9 years of professional 3D graphics development experiences(D3D/OpenGL) and have solid experience of graphics driver developement, for both DirectX and OpenGL/ES.</div></div><footer class="article-footer clearfix"><div class="article-catetags"></div><div class="article-share" id="share"><div data-url="http://yjaelex.github.io/2015/11/08/转-转-Redefining-the-shading-languages-ecosystem-with-SPIR-V/" data-title="[转][转] Redefining the shading languages ecosystem with SPIR-V | 蓝天和白云的博客" data-tsina="undefined" class="share clearfix"></div></div></footer></article><nav class="article-nav clearfix"><div class="prev"><a href="/2015/11/08/转-转-8-reasons-why-SPIR-V-makes-a-big-difference/" title="[转][转] 8 reasons why SPIR-V makes a big difference"><strong>上一篇：</strong><br><span>[转][转] 8 reasons why SPIR-V makes a big difference</span></a></div><div class="next"><a href="/2015/09/29/转-转-A-trip-through-the-Graphics-Pipeline/" title="[转][转] A trip through the Graphics Pipeline"><strong>下一篇：</strong><br><span>[转][转] A trip through the Graphics Pipeline</span></a></div></nav><section id="comments" class="comment"><div class="ds-thread" data-thread-key="2015/11/08/转-转-Redefining-the-shading-languages-ecosystem-with-SPIR-V/" data-title="[转][转] Redefining the shading languages ecosystem with SPIR-V" data-url="http://yjaelex.github.io/2015/11/08/转-转-Redefining-the-shading-languages-ecosystem-with-SPIR-V/"></div></section></div><div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div><div id="toc" class="toc-aside"><strong class="toc-title">文章目录</strong></div><div id="asidepart"><div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div><aside class="clearfix"><div class="github-card"><p class="asidetitle">Github 名片</p><div class="github-card" data-github="yjaelex" data-width="220" data-height="119" data-theme="medium"><script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js"></script></div></div><div class="tagcloudlist"><p class="asidetitle">标签云</p><div class="tagcloudlist clearfix"><a href="/tags/Graphics/" style="font-size:10px">Graphics</a> <a href="/tags/Mantle/" style="font-size:10px">Mantle</a></div></div><div class="archiveslist"><p class="asidetitle"><a href="/archives">归档</a></p><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a><span class="archive-list-count">4</span></li></ul></div><div class="tagslist"><p class="asidetitle">标签</p><ul class="clearfix"><li><a href="/tags/Mantle/" title="Mantle">Mantle<sup>1</sup></a></li><li><a href="/tags/Graphics/" title="Graphics">Graphics<sup>1</sup></a></li></ul></div><div class="hotarticles"><p class="asidetitle">热评文章</p><div class="ds-top-threads" data-range="monthly" data-num-items="5"></div></div><div class="linkslist"><p class="asidetitle">友情链接</p><ul><li><a href="http://blog.csdn.net/qwertyu1234" target="_blank" title="蓝天和白云的CSDN博客">蓝天和白云的CSDN博客</a></li><li><a href="https://github.com/yjaelex/" target="_blank" title="Alex&#39;s Github" rel="external nofollow noopener noreferrer">Alex&#39;s Github</a></li></ul></div><div class="rsspart"><a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a></div></aside></div></div><footer><div id="footer"><div class="line"><span></span><div class="author"></div></div><section class="info"><p>图形学爱好者的家园<br></p></section><div class="social-font"><a href="https://github.com/yjaelex" target="_blank" class="icon-github" title="github" rel="external nofollow noopener noreferrer"></a> <a href="https://www.linkedin.com/in/yjaelex" target="_blank" class="icon-linkedin" title="linkedin" rel="external nofollow noopener noreferrer"></a> <a href="mailto:yjaelex@163.com" target="_blank" class="icon-email" title="Email Me" rel="external nofollow noopener noreferrer"></a></div><p class="copyright">Copyright ©2014-2016 <a href="/about" target="_blank" title="Alex">Alex</a></p></div><script type="text/javascript">var cnzz_protocol="https:"==document.location.protocol?" https://":" http://";document.write(unescape("%3Cspan style='display:none;' id='cnzz_stat_icon_1260545070'%3E%3C/span%3E%3Cscript src='"+cnzz_protocol+"s95.cnzz.com/z_stat.php%3Fid%3D1260545070' type='text/javascript'%3E%3C/script%3E"))</script><script type="text/javascript">!function(t,e,n,s,c,i,a){t.SwiftypeObject=c,t[c]=t[c]||function(){(t[c].q=t[c].q||[]).push(arguments)},i=e.createElement(n),a=e.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","//s.swiftypecdn.com/install/v2/st.js","_st"),_st("install","qFtymqNnfXjgmwxAJxMP","2.0.0")</script></footer><script src="/js/jquery-2.0.3.min.js"></script><script src="/js/jquery.imagesloaded.min.js"></script><script src="/js/gallery.js"></script><script src="/js/jquery.qrcode-0.12.0.min.js"></script><script type="text/javascript">$(document).ready(function(){function e(){"number"==typeof window.innerWidth?n=window.innerWidth:document.documentElement&&document.documentElement.clientWidth&&(n=document.documentElement.clientWidth)}$(".navbar").click(function(){$("header nav").toggleClass("shownav")});var n=0,s=$("#main"),a=$("#asidepart"),o=$(".closeaside"),d=$(".openaside");o.click(function(){a.addClass("fadeOut").css("display","none"),d.css("display","block").addClass("fadeIn"),s.addClass("moveMain")}),d.click(function(){d.css("display","none").removeClass("beforeFadeIn"),a.css("display","block").removeClass("fadeOut").addClass("fadeIn"),s.removeClass("moveMain")}),$(window).scroll(function(){d.css("top",Math.max(80,260-$(this).scrollTop()))}),$(window).resize(function(){e(),n>=1024?$("header nav").removeClass("shownav"):(s.removeClass("moveMain"),a.css("display","block").removeClass("fadeOut"),d.css("display","none"),$("#toc.toc-aside").css("display","none"))})})</script><script type="text/javascript">$(document).ready(function(){var c=$(".article-content>iframe"),n=$(".article-content>embed"),o=($("#toc"),$("#toc.toc-aside")),e=$(".openaside"),i=$(".closeaside");c.length>0&&c.wrap('<div class="video-container" />'),n.length>0&&n.wrap('<div class="video-container" />'),i.click(function(){o.css("display","block").addClass("fadeIn")}),e.click(function(){o.css("display","none")}),$(window).scroll(function(){o.css("top",Math.max(140,320-$(this).scrollTop()))})})</script><script type="text/javascript">$(document).ready(function(){function e(){"number"==typeof window.innerWidth?n=window.innerWidth:document.documentElement&&document.documentElement.clientWidth&&(n=document.documentElement.clientWidth);var e=n>1024?200:100,t={render:"image",size:e,fill:"#2ca6cb",text:r,radius:.5,quiet:1},a=$(".article-share-qrcode").position();$(".hoverqrcode").empty().css("width",e).css("height",e).css("left",a.left-e/2+20).css("top",a.top-e-10).qrcode(t)}var t=$(".share"),r=t.attr("data-url"),a=encodeURIComponent(r),i=t.attr("data-title"),c=t.attr("data-tsina"),o=(t.attr("description"),['<div class="hoverqrcode clearfix"></div>','<a class="overlay" id="qrcode"></a>','<a href="https://www.facebook.com/sharer.php?u='+a+'" class="article-share-facebook" target="_blank" title="Facebook"></a>','<a href="https://twitter.com/intent/tweet?url='+a+'" class="article-share-twitter" target="_blank" title="Twitter"></a>','<a href="#qrcode" class="article-share-qrcode" title="微信"></a>','<a href="http://widget.renren.com/dialog/share?resourceUrl='+a+"&srcUrl="+a+"&title="+i+'" class="article-share-renren" target="_blank" title="人人"></a>','<a href="http://service.weibo.com/share/share.php?title='+i+"&url="+a+"&ralateUid="+c+'&searchPic=true&style=number" class="article-share-weibo" target="_blank" title="微博"></a>','<span title="Share to"></span>'].join(""));t.append(o),$(".hoverqrcode").hide();var n=0;$(window).resize(function(){$(".hoverqrcode").hide()}),$(".article-share-qrcode").click(function(){e(),$(".hoverqrcode").toggle()}),$(".article-share-qrcode").hover(function(){},function(){$(".hoverqrcode").hide()})})</script><script type="text/javascript">var duoshuoQuery={short_name:"yjaelexblog"};!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//static.duoshuo.com/embed.js",e.charset="UTF-8",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script type="text/javascript">$(document).ready(function(){$(".article-content").each(function(a){$(this).find("img").each(function(){if(!$(this).parent().hasClass("fancybox")){var a=this.alt;a&&$(this).after('<span class="caption">'+a+"</span>"),$(this).wrap('<a href="'+this.src+'" title="'+a+'" class="fancybox"></a>')}}),$(this).find(".fancybox").each(function(){$(this).attr("rel","article"+a)})}),$.fancybox&&$(".fancybox").fancybox()})</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?202299ed0711ed4f90ea1e0b0fd936f1";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div id="totop"><a title="返回顶部"><img alt="返回顶部" src="/img/scrollup.png"></a></div><script src="/js/totop.js"></script></body><!-- rebuild by neat -->